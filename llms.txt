# PBWG EUROCONTROL Workbench

High-level R helpers for PBWG workflows at EUROCONTROL. The package
wraps `eurocontrol` primitives and purpose-built SQL to pull NM area
traffic, DAIO, APDF airport data, punctuality extracts, and combined
CHN-EUR summaries.

> Note: The package expects connectivity to PRU Oracle schemas
> (PRU_DEV/PRU_ATMAP) and the `ROracle` client; these are not available
> on CRAN.

## Installation

``` r
# install.packages("devtools")
devtools::install_github("eurocontrol/eurocontrol")   # dependency
devtools::install_github("eurocontrol/pbwg-eurocontrol")
```

## Key functions

- [`pbwg_weight_segment_tfc_counts()`](https://eurocontrol.github.io/pbwg-eurocontrol/reference/pbwg_weight_segment_tfc_counts.md) -
  NM area traffic split by wake turbulence and aircraft category.
- [`pbwg_market_segment_tfc_counts()`](https://eurocontrol.github.io/pbwg-eurocontrol/reference/pbwg_market_segment_tfc_counts.md) -
  NM area traffic by market segment.
- [`pbwg_daio()`](https://eurocontrol.github.io/pbwg-eurocontrol/reference/pbwg_daio.md) -
  Daily DAIO counts for a region.
- [`pbwg_traffic_summary()`](https://eurocontrol.github.io/pbwg-eurocontrol/reference/pbwg_traffic_summary.md)
  /
  [`pbwg_chn_summary()`](https://eurocontrol.github.io/pbwg-eurocontrol/reference/pbwg_chn_summary.md) -
  Composite daily tables used in PBWG outputs.
- [`pbwg_apdf_fetch_airport_raw()`](https://eurocontrol.github.io/pbwg-eurocontrol/reference/pbwg_apdf_fetch_airport_raw.md)
  /
  [`pbwg_apdf_daily_airport_movements()`](https://eurocontrol.github.io/pbwg-eurocontrol/reference/pbwg_apdf_daily_airport_movements.md) -
  APDF airport extracts and daily summaries.
- [`pbwg_otp_punctuality()`](https://eurocontrol.github.io/pbwg-eurocontrol/reference/pbwg_otp_punctuality.md) -
  Punctuality extracts for selected airports/years.

## Usage

``` r
library(pbwg.eurocontrol)

# NM area by wake turbulence category
wtc <- pbwg_weight_segment_tfc_counts(wef = "2024-01-01", til = "2024-01-31")

# DAIO daily counts and composite PBWG summary
daio <- pbwg_daio("2024-01-01", "2024-01-31", region = "ECAC")
summary <- pbwg_traffic_summary("2024-01-01", "2024-01-31")

# APDF airport movements for a set of ICAO codes
apdf <- pbwg_apdf_daily_airport_movements(
  airports = c("EBBR", "EIDW"),
  wef = "2024-01-01",
  til = "2024-01-07"
)
```

Each function accepts an optional `conn` (DBI connection). When omitted,
a fresh Oracle connection is created via
[`eurocontrol::db_connection()`](https://eurocontrol.github.io/eurocontrol/reference/db_connection.html);
ensure your environment provides the required credentials and Oracle
client.

# Package index

## Network-wide traffic counts

NM area counts by wake turbulence and market segment, plus raw DAIO
daily totals.

- [`pbwg_weight_segment_tfc_counts()`](https://eurocontrol.github.io/pbwg-eurocontrol/reference/pbwg_weight_segment_tfc_counts.md)
  : NM area traffic by wake turbulence category
- [`pbwg_market_segment_tfc_counts()`](https://eurocontrol.github.io/pbwg-eurocontrol/reference/pbwg_market_segment_tfc_counts.md)
  : NM area traffic by market segment
- [`pbwg_daio()`](https://eurocontrol.github.io/pbwg-eurocontrol/reference/pbwg_daio.md)
  : Daily DAIO traffic counts

## Regional summaries (EUR / CHN-EUR)

Daily roll-ups that merge DAIO, H/M/L, and market segments, with
diagnostics.

- [`pbwg_traffic_summary()`](https://eurocontrol.github.io/pbwg-eurocontrol/reference/pbwg_traffic_summary.md)
  : PBWG regional traffic summary (EUR view)
- [`pbwg_chn_summary()`](https://eurocontrol.github.io/pbwg-eurocontrol/reference/pbwg_chn_summary.md)
  : CHN-EUR collaboration traffic summary

## Airport-level APDF

APDF pulls for one or more airports, returning raw movement rows or
daily summaries with H/M/L and domestic flags.

- [`pbwg_apdf_fetch_airport_raw()`](https://eurocontrol.github.io/pbwg-eurocontrol/reference/pbwg_apdf_fetch_airport_raw.md)
  : Fetch APDF records for a single airport
- [`pbwg_apdf_daily_airport_movements()`](https://eurocontrol.github.io/pbwg-eurocontrol/reference/pbwg_apdf_daily_airport_movements.md)
  : Daily APDF airport summary

## Punctuality (from CODA AODF)

On-time performance extracts bucketed by \<=15 min vs \>15 min delays
for selected airports/years.

- [`pbwg_otp_punctuality()`](https://eurocontrol.github.io/pbwg-eurocontrol/reference/pbwg_otp_punctuality.md)
  : OTP punctuality extract

## Dataset exporters

Convenience wrapper to pull and persist CHN-EUR datasets in one call.

- [`fetch_chn_eur_datasets()`](https://eurocontrol.github.io/pbwg-eurocontrol/reference/fetch_chn_eur_datasets.md)
  : Fetch CHN-EUR datasets to Parquet

